# ЛР1-3 - Анализ датасета поездок Uber с графическим интерфейсом

## 1. Импорт библиотек и инициализация приложения

```python
import pandas as pd
from tkinter import Tk, filedialog, messagebox, Text, Scrollbar, Frame, Button, Label
import io
import sys
```

**pandas** - для работы с табличными данными  
**tkinter** - для создания графического интерфейса  
**io** - для работы с буферами ввода-вывода  

_Создается главное окно приложения с розовой цветовой схемой_

## 2. Создание пользовательского интерфейса

```python
def setup_ui(self):
    main_container = Frame(self.root, bg='#fff0f5', padx=30, pady=25)
    title_label = Label(header_frame, text="Анализ данных Uber", ...)
```

**Элементы интерфейса:**

+ **Заголовок** - "Анализ данных Uber - Kostochka Edition"
+ **Кнопка загрузки** - Загрузить CSV файл
+ **Кнопка обзора** - Обзор данных
+ **Кнопка анализа** - Полный анализ
+ **Область вывода** - Текстовое поле с прокруткой
+ **Статус бар** - Информация о состоянии данных

_Интерфейс использует розовую цветовую палитру для визуального оформления_

## 3. Загрузка и первичный анализ данных

```python
def load_file(self):
    file_path = filedialog.askopenfilename()
    self.df = pd.read_csv(file_path)
```

**Процесс загрузки:**

+ Открытие диалогового окна выбора файла
+ Чтение CSV файла в DataFrame
+ Проверка успешности загрузки
+ Обновление интерфейса

_После загрузки активируются кнопки анализа и показывается базовая информация о файле_

## 4. Статистический обзор данных

```python
def perform_data_overview(self):
```

**Анализируемые аспекты:**

### 4.1 Анализ пропущенных значений

```python
missing_data = self.df.isnull().sum()
missing_percent = (missing_data / len(self.df)) * 100
```

_Вычисляет количество и процент пропусков по каждому столбцу_

### 4.2 Анализ категориальных колонок

```python
categorical_columns = self.df.select_dtypes(include=['object']).columns
```

_Находит текстовые столбцы и анализирует уникальные значения_

### 4.3 Анализ ключевых колонок

```python
booking_status_col = self.find_booking_status_column()
vehicle_type_col = self.find_vehicle_type_column()
```

_Автоматически определяет столбцы статуса бронирования и типа транспорта_

### 4.4 Статистика числовых колонок

```python
numerical_columns = self.df.select_dtypes(include=['int64', 'float64']).columns
stats = self.df[col].describe()
```

_Генерирует описательную статистику для числовых данных_

## 5. Полный анализ данных по техническому заданию

```python
def perform_full_analysis(self):
```

### 5.1 Первичный осмотр данных

`print(df.head())` - первые 5 строк  
`print(df.info())` - информация о структуре  
`print(df.describe())` - статистическое описание  

_Цель: Понять структуру данных, типы переменных, наличие пропусков_

### 5.2 Автоматическое определение столбцов

```python
def find_columns(self):
    if 'booking' in col_lower and 'id' in col_lower:
        column_mapping['booking_id'] = col
```

**Определяемые столбцы:**

+ **booking_id** - идентификатор бронирования
+ **booking_datetime** - дата и время бронирования
+ **booking_status** - статус бронирования
+ **vehicle_type** - тип транспортного средства
+ **payment_method** - способ оплаты
+ **booking_value** - стоимость бронирования

## 6. Фильтрация данных по ТЗ

### 6.1 Выборка конкретных колонок

```python
def select_columns(self, column_mapping):
    needed_cols = ['booking_id', 'booking_datetime', 'booking_status', 'vehicle_type', 'payment_method']
```

_Создает подмножество данных с выбранными столбцами для анализа_

### 6.2 Фильтрация отмененных водителем

```python
def filter_cancelled(self, column_mapping):
    status_variants = ['Cancelled by Driver', 'Canceled by Driver', 'Cancelled']
```

_Находит поездки, отмененные водителем с учетом различных вариантов написания статусов_

### 6.3 Фильтрация Auto с высокой стоимостью

```python
def filter_auto_high_value(self, column_mapping):
    return df[(vehicle_type == 'Auto') & (booking_value > 500)]
```

_Фильтрует поездки на авто-рикшах стоимостью более 500 единиц_

### 6.4 Фильтрация за март 2024

```python
def filter_march_2024(self, column_mapping):
    return df[(datetime >= '2024-03-01') & (datetime <= '2024-03-31')]
```

_Выбирает бронирования за март 2024 года для анализа сезонных тенденций_

## 7. Вспомогательные функции

### 7.1 Логирование сообщений

```python
def log_message(self, message, tag=None):
    self.text_area.insert("end", message + "\n", tag)
```

_Выводит сообщения в текстовую область с форматированием по категориям_

### 7.2 Обработка ошибок

```python
try:
    # операции с данными
except Exception as e:
    messagebox.showerror("Ошибка", f"Не удалось загрузить файл:\n{str(e)}")
```

_Предоставляет информативные сообщения об ошибках для пользователя_

# ЛР4 - Ride Price Predictor - Модель машинного обучения для прогнозирования стоимости поездок

## 1. Импорт библиотек и настройка окружения

```python
import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
import seaborn as sns
from sklearn.linear_model import LinearRegression
from sklearn.model_selection import train_test_split
from sklearn.metrics import mean_absolute_error, r2_score

# Настройка стиля для красивого дизайна
plt.style.use('seaborn-v0_8')
sns.set_palette("husl")
```

## 2. Структура класса RidePricePredictor

### 2.1 Инициализация

```python
def __init__(self):
    self.model = LinearRegression()
    self.is_trained = False
```

_Создает модель линейной регрессии_  
_Флаг **is_trained** отслеживает состояние обучения_

### 2.2 Генерация синтетических данных

```python
def generate_sample_data(self, n_samples=200):
```

**Создает искусственные данные:**
+ **distances** - случайные расстояния от 1 до 50 км
+ **prices** - рассчитываются по формуле `50 + 15 * расстояние + шум`
+ **time_of_day** - категориальный признак (Утро/День/Вечер/Ночь)
+ **day_of_week** - категориальный признак (Будни/Выходные)

_Формула цены:_ `base_price + price_per_km * distances + noise`

### 2.3 Обучение модели

```python
def train_model(self):
    X = self.df[['distance']].values  
    y = self.df['price'].values
```

**Процесс обучения:**
+ Разделяет данные на обучающую и тестовую выборки (80%/20%)
+ Обучает линейную регрессию на признаке расстояния
+ Вычисляет метрики качества модели

**Метрики качества:**
+ **MAE (Mean Absolute Error)** - средняя абсолютная ошибка в рублях
+ **R² (R-squared)** - коэффициент детерминации (0-1)

### 2.4 Предсказание цены

```python
def predict_price(self, distance):
    price = self.model.predict([[distance]])[0]
    return max(price, 40)
```

_Возвращает предсказанную стоимость для заданного расстояния_  
_Гарантирует минимальную цену 40 рублей_

## 3. Визуализации

### 3.1 Основная визуализация

```python
def create_visualization(self, test_distance=None):
```

**Создает 4 графика в одной фигуре:**

#### График 1: Зависимость цены от расстояния
+ **Тип:** Scatter plot с линией регрессии
+ **Ось X:** Расстояние (км)
+ **Ось Y:** Стоимость (руб)
+ **Особенности:** Цветовая градация по стоимости, тестовая точка с золотой звездой

#### График 2: Распределение ошибок
+ **Тип:** Гистограмма с градиентной заливкой
+ **Ось X:** Ошибка предсказания (руб)
+ **Ось Y:** Частота ошибок
+ **Особенности:** Показывает точность модели

#### График 3: Средняя стоимость по времени суток
+ **Тип:** Bar plot
+ **Ось X:** Время суток (Утро/День/Вечер/Ночь)
+ **Ось Y:** Средняя стоимость (руб)
+ **Особенности:** Цветные столбцы с подписанными значениями

#### График 4: Корреляционная матрица
+ **Тип:** Heatmap
+ **Данные:** Корреляции между расстоянием и стоимостью
+ **Особенности:** Цветовая схема RdYlBu_r, аннотированные значения

### 3.2 Визуализация предсказаний в диапазоне

```python
def plot_predictions_range(self):
```

**Создает градиентный график:**
+ **Тип:** Line collection с цветовой градацией
+ **Диапазон:** Расстояния от 1 до 50 км
+ **Особенности:** Плавный цветовой переход в зависимости от расстояния

## 4. Улучшенный вывод статистики

```python
def print_fancy_stats(self, mae, r2):
```

**Форматированный вывод в консоль:**
+ Оформление в виде таблицы с символами псевдографики
+ Оценка качества модели на основе R²:
  - R² > 0.7: "Отличное"
  - R² > 0.5: "Хорошее"  
  - Иначе: "Удовлетворительное"
+ Визуальные элементы (эмодзи, рамки)

## 5. Работа программы

```python
def main():
    predictor = RidePricePredictor()
    data = predictor.generate_sample_data(200)
    mae, r2 = predictor.train_model()
```

**Выполняет последовательность:**
1. Создание экземпляра предсказателя
2. Генерация 200 примеров поездок
3. Обучение модели линейной регрессии
4. Тестовые предсказания для расстояний: 5, 15, 25, 35, 45 км
5. Построение комплексной визуализации
6. Создание градиентного графика предсказаний

## 6. Особенности реализации

### 6.1 Дизайн и визуализация
+ Использование темы `seaborn-v0_8-darkgrid`
+ Градиентные цветовые схемы
+ Профессиональное оформление графиков
+ Интерактивные элементы (тестовые точки)

### 6.2 Пользовательский опыт
+ Красивый форматированный вывод в консоль
+ Пошаговая визуализация результатов
+ Четкая структура вывода информации
+ Визуальные индикаторы качества модели

### 6.3 Функциональность
+ Автоматическая генерация реалистичных данных
+ Обучение и валидация модели
+ Комплексный анализ результатов
+ Множественные типы визуализаций

## 7. Технические характеристики

**Модель:** Линейная регрессия  
**Признаки:** Расстояние поездки  
**Целевая переменная:** Стоимость поездки  
**Размер данных:** 200 синтетических примеров  
**Валидация:** 20% тестовая выборка  

## 8. Результаты работы

**Выходные данные:**
+ Статистика качества модели (MAE, R²)
+ Таблица предсказаний для различных расстояний
+ Комплексная визуализация из 4 графиков
+ Градиентный график предсказаний в диапазоне

**Визуализации сохраняются в формате:**
+ Интерактивные окна matplotlib
+ Высокое качество отображения
+ Профессиональное оформление для презентаций
```
# ЛР5 - Uber Price Predictor - Система прогнозирования стоимости поездок с GUI

## 1. Архитектура приложения

### 1.1 Основные компоненты

**Класс UberPricePredictor** - ядро машинного обучения
```python
class UberPricePredictor:
    def __init__(self):
        self.model = None
        self.scaler = StandardScaler()
        self.label_encoders = {}
        self.feature_importance = None
```

**Класс UberPricePredictorGUI** - графический интерфейс
```python
class UberPricePredictorGUI:
    def __init__(self):
        self.root = tk.Tk()
        self.predictor = UberPricePredictor()
```

### 1.2 Технологический стек

+ **Машинное обучение:** RandomForestRegressor из scikit-learn
+ **Графический интерфейс:** Tkinter с кастомными стилями
+ **Визуализация:** Matplotlib с интеграцией в Tkinter
+ **Обработка данных:** Pandas и NumPy
+ **Предобработка:** StandardScaler, LabelEncoder

## 2. Функциональность машинного обучения

### 2.1 Загрузка и подготовка данных

```python
def load_data(self, file_path):
    self.df = pd.read_csv(file_path)
    self.df = self.df.dropna(subset=['Booking Value'])
```

**Обработка данных:**
+ Удаление записей с пропущенными значениями стоимости
+ Проверка качества данных (NaN, отрицательные значения)
+ Статистический анализ целевой переменной

### 2.2 Создание признаков (Feature Engineering)

```python
def create_additional_features(self):
```

**Временные признаки:**
+ `hour` - час бронирования (0-23)
+ `day_of_week` - день недели (0-6)
+ `is_weekend` - флаг выходного дня
+ `month` - месяц бронирования
+ `is_peak_hours` - пиковые часы (7-9, 17-19)

**Погодные и внешние факторы:**
+ `temperature` - температура воздуха
+ `precipitation` - уровень осадков
+ `is_rainy` - флаг дождливой погоды
+ `demand_surge` - коэффициент спроса

**Географические и сервисные факторы:**
+ `trip_distance_km` - расстояние поездки
+ `estimated_duration_min` - расчетное время
+ `is_city_center` - флаг центра города
+ `area_traffic_density` - плотность трафика

### 2.3 Подготовка данных для ML

```python
def prepare_features_for_ml(self):
```

**Процесс подготовки:**
1. Выделение целевой переменной `Booking Value`
2. Создание матрицы признаков из 18+ факторов
3. Кодирование категориальных переменных
4. Масштабирование числовых признаков
5. Разделение на обучающую и тестовую выборки

### 2.4 Обучение модели

```python
def train_model(self):
    self.model = RandomForestRegressor(
        n_estimators=100,
        max_depth=10,
        random_state=42,
        n_jobs=-1
    )
```

**Параметры модели:**
+ **Алгоритм:** Случайный лес (Random Forest)
+ **Деревья:** 100 estimators
+ **Глубина:** max_depth=10
+ **Валидация:** 80/20 split

**Метрики качества:**
+ **MAE (Mean Absolute Error)** - средняя абсолютная ошибка
+ **R² (R-squared)** - коэффициент детерминации

### 2.5 Предсказание и анализ

```python
def predict_price(self, input_features):
    input_scaled = self.scaler.transform(input_df)
    return self.model.predict(input_scaled)[0]
```

**Анализ важности признаков:**
+ Ранжирование факторов по влиянию на стоимость
+ Топ-10 наиболее значимых признаков
+ Визуализация важности в GUI

## 3. Графический интерфейс

### 3.1 Дизайн и тематика

**Цветовая схема:** Розовая палитра
+ Основной фон: `#fff0f5` (светло-розовый)
+ Акцентные цвета: `#e83e8c`, `#d63384`, `#c2185b`
+ Текстовые цвета: Оттенки розового и бордового

**Стилизация элементов:**
+ Кастомные кнопки с эмодзи
+ Вкладки с розовым оформлением
+ Скроллируемые области для результатов
+ Интегрированные графики matplotlib

### 3.2 Структура интерфейса

**Основные разделы:**
1. **Панель управления** - кнопки загрузки, анализа, обучения
2. **Вкладка результатов** - текстовый вывод анализа
3. **Вкладка диаграмм** - визуализации данных


### 3.3 Визуализации данных

#### Диаграмма 1: Цена vs Расстояние
+ **Тип:** Scatter plot с линией тренда
+ **Цветовая схема:** Градиент RdPu
+ **Аннотации:** Среднее значение, цветочные эмодзи

#### Диаграмма 2: Влияние погоды на цену
+ **Тип:** Bar chart
+ **Данные:** Средняя стоимость по погодным условиям
+ **Особенности:** Подписанные значения на столбцах

#### Диаграмма 3: Матрица корреляций
+ **Тип:** Heatmap
+ **Палитра:** RdPu с аннотациями
+ **Назначение:** Анализ взаимосвязей между факторами

#### Диаграмма 4: Важность признаков
+ **Тип:** Horizontal bar chart
+ **Данные:** Топ-10 факторов влияния на цену
+ **Визуализация:** Градиентная заливка по важности

#### Диаграмма 5: Распределение цен
+ **Тип:** Histogram
+ **Анализ:** Распределение стоимости поездок
+ **Элементы:** Линия среднего значения

#### Диаграмма 6: Динамика по времени суток
+ **Тип:** Line plot с заливкой
+ **Данные:** Изменение цен в течение дня
+ **Подсветка:** Пиковые часы

## 4. Бизнес-логика и аналитика

### 4.1 Динамическое ценообразование

```python
def calculate_dynamic_pricing(self):
```

**Факторы ценообразования:**
+ Базовые тарифы по типам транспорта
+ Стоимость за километр и минуту
+ Мультипликаторы спроса и погоды
+ Коэффициенты трафика и времени суток

### 4.2 Анализ качества данных

**Проверяемые аспекты:**
+ Полнота данных (пропущенные значения)
+ Корректность числовых значений
+ Статистика целевой переменной
+ Распределение по типам транспорта

### 4.3 Генерация отчетов

**Содержание отчета:**
+ Сравнение фактической и расчетной стоимости
+ Статистика по типам транспортных средств
+ Анализ важности факторов ценообразования
+ Примеры предсказаний для типовых сценариев

## 5. Особенности реализации

### 5.1 Обработка ошибок

```python
try:
    # бизнес-логика
except Exception as e:
    messagebox.showerror("Ошибка", f" Не удалось загрузить данные:\n{str(e)}")
```

**Многоуровневая обработка:**
+ Валидация входных данных
+ Обработка исключений ML алгоритмов
+ Пользовательские сообщения об ошибках
+ Graceful degradation при проблемах

### 5.2 Производительность

**Оптимизации:**
+ Параллельные вычисления (n_jobs=-1)
+ Эффективная работа с большими датасетами
+ Кэширование подготовленных данных
+ Оптимизированные визуализации

### 5.3 Пользовательский опыт

**Удобство использования:**
+ Пошаговый процесс анализа
+ Визуальный feedback операций
+ Подробные отчеты и выводы
+ Интуитивная навигация




